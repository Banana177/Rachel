ä¸‹é¢ç»™ä½ ä¸€ä¸ª **ESP32-S3 + ST7789ï¼ˆ1.3å¯¸ 240Ã—240ï¼‰æœ€ç»ˆç¨³å®šç‰ˆè£¸é©±åŠ¨**ã€‚

ç‰¹ç‚¹ï¼š

* âœ… ä¸ä½¿ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹åº“
* âœ… å…¼å®¹ ESP32-S3
* âœ… æ”¯æŒ CS å¯é€‰
* âœ… è‡ªåŠ¨é€‚é… 240Ã—240 åç§»
* âœ… SPI MODE3ï¼ˆå®æµ‹ç¨³å®šï¼‰
* âœ… ä½é€Ÿå¯åŠ¨ + å¯æé€Ÿ
* âœ… å¯ç›´æ¥ç”¨äºäº§å“çº§åŸºç¡€é©±åŠ¨

---

# âš™ï¸ é»˜è®¤ç¡¬ä»¶è¿æ¥

| TFT | ESP32-S3            |
| --- | ------------------- |
| SCL | 41                  |
| SDA | 40                  |
| DC  | 42                  |
| RST | 12                  |
| BLK | 11                  |
| CS  | æ¥ GNDï¼ˆæˆ–ä½¿ç”¨ GPIOï¼Œè§ä»£ç ï¼‰ |
| VCC | 3.3V                |
| GND | GND                 |

---

# ğŸš€ æœ€ç»ˆç¨³å®šå®Œæ•´ä»£ç 

ç›´æ¥æ•´æ®µå¤åˆ¶çƒ§å½•ã€‚

```cpp
#include <Arduino.h>
#include <SPI.h>

/* ================== å¼•è„šå®šä¹‰ ================== */
#define PIN_BLK 11
#define PIN_RST 12
#define PIN_DC  42
#define PIN_SCK 41
#define PIN_MOSI 40

// å¦‚æœä½ çš„æ¨¡å—æœ‰ CS å¼•è„šï¼Œå¡« GPIOï¼›
// å¦‚æœ CS å·²æ¥åœ°ï¼Œå¡« -1
#define PIN_CS  -1

/* ================== å±å¹•å‚æ•° ================== */
#define TFT_WIDTH   240
#define TFT_HEIGHT  240

// æŸäº› 1.3å¯¸ ST7789 éœ€è¦ X åç§» 80
#define X_OFFSET  0     // å¦‚æœæ— æ˜¾ç¤ºï¼Œæ”¹ä¸º 80
#define Y_OFFSET  0

/* ================== SPI ================== */
SPIClass spi(FSPI);

/* ================== åº•å±‚å‡½æ•° ================== */

inline void csLow()  { if(PIN_CS!=-1) digitalWrite(PIN_CS, LOW); }
inline void csHigh() { if(PIN_CS!=-1) digitalWrite(PIN_CS, HIGH); }

void writeCmd(uint8_t cmd)
{
    csLow();
    digitalWrite(PIN_DC, LOW);
    spi.transfer(cmd);
    csHigh();
}

void writeData(uint8_t data)
{
    csLow();
    digitalWrite(PIN_DC, HIGH);
    spi.transfer(data);
    csHigh();
}

void writeData16(uint16_t data)
{
    csLow();
    digitalWrite(PIN_DC, HIGH);
    spi.transfer(data >> 8);
    spi.transfer(data & 0xFF);
    csHigh();
}

/* ================== åœ°å€çª—å£ ================== */

void setAddrWindow(uint16_t x0,uint16_t y0,uint16_t x1,uint16_t y1)
{
    x0 += X_OFFSET;
    x1 += X_OFFSET;
    y0 += Y_OFFSET;
    y1 += Y_OFFSET;

    writeCmd(0x2A);
    writeData16(x0);
    writeData16(x1);

    writeCmd(0x2B);
    writeData16(y0);
    writeData16(y1);

    writeCmd(0x2C);
}

/* ================== å¡«å……å±å¹• ================== */

void fillScreen(uint16_t color)
{
    setAddrWindow(0,0,TFT_WIDTH-1,TFT_HEIGHT-1);

    csLow();
    digitalWrite(PIN_DC, HIGH);

    for(uint32_t i=0;i<TFT_WIDTH*TFT_HEIGHT;i++)
    {
        spi.transfer(color>>8);
        spi.transfer(color&0xFF);
    }

    csHigh();
}

/* ================== å¤ä½ ================== */

void tftReset()
{
    digitalWrite(PIN_RST, LOW);
    delay(50);
    digitalWrite(PIN_RST, HIGH);
    delay(120);
}

/* ================== ST7789 åˆå§‹åŒ– ================== */

void tftInit()
{
    tftReset();

    writeCmd(0x11);   // Sleep out
    delay(120);

    writeCmd(0x36);   // MADCTL
    writeData(0x00);  // æ–¹å‘

    writeCmd(0x3A);   // 16bit color
    writeData(0x05);

    writeCmd(0x21);   // Inversion ONï¼ˆæå‡å¯¹æ¯”åº¦ï¼‰

    writeCmd(0x29);   // Display ON
    delay(20);
}

/* ================== SETUP ================== */

void setup()
{
    Serial.begin(115200);
    delay(1000);

    pinMode(PIN_DC, OUTPUT);
    pinMode(PIN_RST, OUTPUT);
    pinMode(PIN_BLK, OUTPUT);

    if(PIN_CS!=-1) pinMode(PIN_CS, OUTPUT);

    digitalWrite(PIN_BLK, HIGH);  // å¼€èƒŒå…‰
    if(PIN_CS!=-1) digitalWrite(PIN_CS, HIGH);

    // â­ å…³é”®ï¼šSPI MODE3 + ä½é€Ÿå¯åŠ¨
    spi.begin(PIN_SCK, -1, PIN_MOSI, -1);
    spi.beginTransaction(SPISettings(8000000, MSBFIRST, SPI_MODE3));

    tftInit();

    // ===== æµ‹è¯•é¢œè‰² =====
    fillScreen(0xF800); delay(800); // çº¢
    fillScreen(0x07E0); delay(800); // ç»¿
    fillScreen(0x001F); delay(800); // è“
    fillScreen(0xFFFF); delay(800); // ç™½
    fillScreen(0x0000); delay(800); // é»‘
}

/* ================== LOOP ================== */

void loop()
{
}
```

---

# ğŸ¯ å¦‚æœä»ç„¶é»‘å±ï¼Œè¯·æŒ‰ä¸‹é¢æ­¥éª¤æµ‹è¯•

---

## â‘  å°è¯• SPI_MODE0

æŠŠï¼š

```cpp
SPI_MODE3
```

æ”¹ä¸ºï¼š

```cpp
SPI_MODE0
```

---

## â‘¡ å¦‚æœå®Œå…¨æ— æ˜¾ç¤ºï¼Œæ”¹åç§»

```cpp
#define X_OFFSET 80
```

å†æµ‹è¯•ã€‚

---

## â‘¢ é™ä½ SPI é¢‘ç‡

```cpp
SPISettings(4000000, MSBFIRST, SPI_MODE3)
```

---

## â‘£ å¦‚æœæœ‰ CS å¼•è„š

ä¸è¦æ‚¬ç©ºï¼š

* æ¥ GND
  æˆ–
* ä½¿ç”¨ GPIO å¹¶åœ¨ä»£ç ä¸­å¯ç”¨

---

# ğŸ”¬ å®æˆ˜ç»éªŒç»“è®º

ESP32-S3 + 1.3å¯¸ ST7789 é»‘å± 99% åŸå› ï¼š

1. SPI æ¨¡å¼é”™è¯¯
2. CS æ‚¬ç©º
3. éœ€è¦ 80px åç§»
4. å±å¹•å…¶å®ä¸æ˜¯ ST7789

---

å¦‚æœä½ ç°åœ¨æµ‹è¯•åä»é»‘å±ï¼Œå‘Šè¯‰æˆ‘ï¼š

* æ¨¡å—èƒŒé¢ä¸å°å†…å®¹
* æ˜¯å¦æœ‰ CS
* æ˜¯å¦ 1.3å¯¸ 240Ã—240 IPS

æˆ‘å¯ä»¥ç»™ä½ é’ˆå¯¹è¯¥æ‰¹æ¬¡å±å¹•çš„ä¸“ç”¨åˆå§‹åŒ–å‚æ•°ã€‚
